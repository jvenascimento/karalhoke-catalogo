<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Digital - Karalhok√™ üé§</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- √çcones (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- DESIGN SYSTEM (Igual ao App Principal) --- */
        :root {
            --bg-deep: #0a0a0f;
            --neon-cyan: #00fff2;
            --neon-pink: #ff00ea;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-dim: #a0a0b0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(0, 255, 242, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(255, 0, 234, 0.05) 0%, transparent 30%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* --- HEADER --- */
        .header {
            text-align: center; margin-bottom: 30px; width: 100%; max-width: 600px;
        }
        
        .logo {
            font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: white;
            text-shadow: 0 0 15px var(--neon-pink); margin-bottom: 5px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .logo i { color: var(--neon-cyan); animation: pulse 2s infinite; }
        
        .subtitle { color: var(--neon-cyan); letter-spacing: 2px; font-size: 0.9rem; text-transform: uppercase; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- SEARCH --- */
        .search-container {
            width: 100%; max-width: 600px; position: sticky; top: 20px; z-index: 100;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%; padding: 15px 25px; border-radius: 50px;
            border: 2px solid var(--glass-border);
            background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(10px);
            color: white; font-size: 1.1rem; outline: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        
        .search-input:focus {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 242, 0.3);
        }

        /* --- LISTA --- */
        .catalog-list {
            width: 100%; max-width: 600px;
            display: flex; flex-direction: column; gap: 15px;
            padding-bottom: 80px; /* Espa√ßo para o footer */
        }

        .song-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px 20px;
            display: flex; align-items: center; justify-content: space-between;
            transition: all 0.2s ease;
            animation: slideIn 0.3s ease-out;
        }
        
        .song-item:hover {
            border-color: var(--neon-pink);
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .song-info { display: flex; flex-direction: column; overflow: hidden; }
        
        .song-id {
            color: var(--neon-cyan); font-family: 'Fredoka One'; font-size: 0.9rem;
            margin-bottom: 2px;
        }
        
        .song-title { font-weight: bold; font-size: 1.1rem; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-artist { color: var(--text-dim); font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ESTADO VAZIO --- */
        .empty-state {
            text-align: center; color: var(--text-dim); margin-top: 50px;
            padding: 40px; border: 2px dashed var(--glass-border); border-radius: 20px;
        }
        .empty-state i { font-size: 3rem; margin-bottom: 15px; opacity: 0.5; color: var(--neon-pink); }

        /* --- FOOTER / ADMIN --- */
        .footer-admin {
            position: fixed; bottom: 20px; right: 20px; z-index: 200;
        }
        
        .admin-btn {
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(0,0,0,0.8); border: 1px solid var(--text-dim);
            color: var(--text-dim); font-size: 1.2rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        .admin-btn:hover {
            color: var(--neon-cyan); border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 242, 0.3); transform: rotate(15deg);
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        
        .modal-box {
            background: #1a1a20; border: 1px solid var(--neon-pink);
            padding: 30px; border-radius: 20px; width: 90%; max-width: 400px;
            text-align: center; box-shadow: 0 0 40px rgba(255, 0, 234, 0.15);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .modal-title { color: var(--neon-pink); font-family: 'Fredoka One'; font-size: 1.5rem; margin-bottom: 20px; }
        
        .modal-input {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3);
            border: 1px solid #444; color: white; border-radius: 8px;
            margin-bottom: 20px; font-size: 1.2rem; text-align: center; letter-spacing: 5px;
        }
        .modal-input:focus { border-color: var(--neon-cyan); outline: none; }

        /* CORRE√á√ÉO DO BOT√ÉO DE UPLOAD */
        .file-input-wrapper {
            margin-top: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px dashed var(--neon-cyan); padding: 30px; border-radius: 10px;
            cursor: pointer; transition: 0.3s; background: rgba(0, 255, 242, 0.05);
        }
        .file-input-wrapper:hover { background: rgba(0, 255, 242, 0.15); transform: scale(1.02); }

        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            font-weight: bold; font-family: 'Fredoka One'; margin-top: 10px;
        }
        .btn-primary { background: var(--neon-cyan); color: #000; width: 100%; }
        .btn-close { background: transparent; color: #666; margin-top: 10px; }
        .btn-close:hover { color: white; }

        .success-msg { color: #25D366; font-size: 0.9rem; margin-top: 10px; display: none; }
        .error-msg { color: #ff4444; font-size: 0.9rem; margin-top: 10px; display: none; }

        /* Anima√ß√£o de erro */
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-microphone-alt"></i>
            <span>KARALHOK√ä</span>
        </div>
        <div class="subtitle">CARD√ÅPIO DIGITAL</div>
    </header>

    <!-- Search -->
    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç Pesquise por cantor, m√∫sica ou ID..." autocomplete="off">
    </div>

    <!-- Lista de M√∫sicas -->
    <div class="catalog-list" id="catalogList">
        <!-- Renderiza√ß√£o via JS -->
        <div class="empty-state">
            <i class="fas fa-compact-disc fa-spin"></i>
            <h3>Cat√°logo vazio</h3>
            <p>Aguardando o DJ atualizar a lista.</p>
        </div>
    </div>

    <!-- Bot√£o Admin -->
    <div class="footer-admin">
        <button class="admin-btn" onclick="openAdminModal()">
            <i class="fas fa-lock"></i>
        </button>
    </div>

    <!-- Modal Admin -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal-box">
            <div class="modal-title">√ÅREA DO DJ</div>
            
            <!-- Etapa 1: Senha -->
            <div id="stepPassword">
                <p style="color:#aaa; margin-bottom:10px; font-size:0.9rem;">Digite a senha para atualizar o cat√°logo</p>
                <input type="password" id="passwordInput" class="modal-input" placeholder="****" maxlength="4">
                <button class="btn btn-primary" onclick="checkPassword()">ACESSAR</button>
                <p class="error-msg" id="passError">Senha incorreta!</p>
            </div>

            <!-- Etapa 2: Upload -->
            <div id="stepUpload" style="display:none;">
                <p style="color:var(--neon-cyan); margin-bottom:10px;">Acesso Liberado!</p>
                <label for="jsonFileInput" class="file-input-wrapper">
                    <i class="fas fa-file-upload" style="font-size:2rem; color:white; margin-bottom:10px;"></i>
                    <div style="color:#aaa; font-size:0.9rem;">Clique aqui para selecionar o arquivo<br><strong>karalhoke_library.json</strong></div>
                </label>
                <input type="file" id="jsonFileInput" accept=".json" style="display:none;" onchange="processFile(this)">
                <p class="success-msg" id="uploadSuccess"><i class="fas fa-check-circle"></i> Cat√°logo atualizado com sucesso!</p>
            </div>

            <button class="btn btn-close" onclick="closeAdminModal()">Fechar</button>
        </div>
    </div>

    <script>
        const SECRET = "0208";
        let catalogData = [];

        // --- INICIALIZA√á√ÉO ---
        window.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
        });

        // --- SISTEMA DE BUSCA ---
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            filterCatalog(term);
        });

        function filterCatalog(term) {
            if (!catalogData.length) return;
            
            const filtered = catalogData.filter(song => 
                song.title.toLowerCase().includes(term) ||
                song.artist.toLowerCase().includes(term) ||
                song.id.includes(term)
            );
            
            renderList(filtered);
        }

        // --- RENDERIZA√á√ÉO ---
        function renderList(list) {
            const container = document.getElementById('catalogList');
            container.innerHTML = '';

            if (list.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>Nenhuma m√∫sica encontrada.</p>
                    </div>`;
                return;
            }

            // Otimiza√ß√£o: Renderizar apenas os primeiros 100 itens inicialmente para performance
            const displayList = list.slice(0, 100);

            displayList.forEach(song => {
                const item = document.createElement('div');
                item.className = 'song-item';
                item.innerHTML = `
                    <div class="song-info">
                        <span class="song-id">#${song.id}</span>
                        <span class="song-title">${song.title}</span>
                        <span class="song-artist">${song.artist}</span>
                    </div>
                    <i class="fas fa-music" style="color: var(--glass-border);"></i>
                `;
                container.appendChild(item);
            });

            if (list.length > 100) {
                const more = document.createElement('div');
                more.style.textAlign = 'center';
                more.style.color = '#666';
                more.style.padding = '10px';
                more.innerText = `... e mais ${list.length - 100} m√∫sicas. Use a busca!`;
                container.appendChild(more);
            }
        }

        // --- ADMIN & UPLOAD ---
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
            document.getElementById('stepPassword').style.display = 'block';
            document.getElementById('stepUpload').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passError').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'none';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === SECRET) {
                document.getElementById('stepPassword').style.display = 'none';
                document.getElementById('stepUpload').style.display = 'block';
            } else {
                const err = document.getElementById('passError');
                err.style.display = 'block';
                err.classList.add('shake');
                setTimeout(() => err.classList.remove('shake'), 500);
            }
        }

        function processFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    
                    // Valida√ß√£o simples: verifica se √© um array e tem 'id' no primeiro item
                    if (Array.isArray(json) && json.length > 0 && json[0].id) {
                        catalogData = json;
                        saveToStorage(json);
                        renderList(json);
                        
                        document.getElementById('uploadSuccess').style.display = 'block';
                        setTimeout(() => closeAdminModal(), 1500);
                    } else {
                        alert("Arquivo inv√°lido! O arquivo JSON deve ter sido gerado pelo App do DJ.");
                    }
                } catch (err) {
                    alert("Erro ao ler arquivo. Verifique se √© um arquivo .json v√°lido.");
                }
            };
            reader.readAsText(file);
        }

        // --- PERSIST√äNCIA (LOCALSTORAGE) ---
        function saveToStorage(data) {
            try {
                localStorage.setItem('karalhoke_catalog', JSON.stringify(data));
            } catch (e) {
                console.warn("Storage cheio ou indispon√≠vel");
            }
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('karalhoke_catalog');
            if (saved) {
                try {
                    catalogData = JSON.parse(saved);
                    renderList(catalogData);
                } catch (e) {
                    console.error("Erro ao carregar cache");
                }
            } else {
                // Tenta carregar um arquivo local padr√£o caso exista na pasta
                fetch('catalog.json')
                    .then(res => res.json())
                    .then(data => {
                        catalogData = data;
                        renderList(data);
                    })
                    .catch(() => {
                        // Se falhar, fica no empty state
                        console.log("Nenhum cat√°logo local encontrado.");
                    });
            }
        }

    </script>
</body>
</html>
